<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¯„è®ºå±‚çº§æ¸²æŸ“ç¤ºä¾‹</title>
  <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            padding: 20px;
        }
        .comment-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
        }
        .comment-item .comment-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .comment-item .userName {
            font-weight: bold;
            color: #333;
        }
        .comment-item .comment-content {
            margin: 5px 0;
            color: #555;
        }
        .comment-item .comment-date {
            font-size: 12px;
            color: #999;
            display: inline-block; /* ä½¿åˆ›å»ºæ—¶é—´å’Œå›å¤æŒ‰é’®åœ¨åŒä¸€è¡Œ */
        }
        .comment-item .reply-button {
            font-size: 12px;
            color: #666;
            cursor: pointer;
            margin-left: 10px; /* ä¸åˆ›å»ºæ—¶é—´çš„é—´è· */
            display: inline-block; /* ä½¿å›å¤æŒ‰é’®ä¸åˆ›å»ºæ—¶é—´åœ¨åŒä¸€è¡Œ */
        }
        .comment-item .reply-button:hover {
            color: #333; /* é¼ æ ‡æ‚¬åœæ—¶å˜è‰² */
        }
        .comment-item .comment-children {
            margin-left: 20px; /* ç›´æ¥å­è¯„è®ºç¼©è¿› */
        }
        .comment-item .comment-children-nested {
            margin-left: 0; /* åµŒå¥—å­è¯„è®ºä¸ç¼©è¿› */
            padding-left: 0; /* ç¡®ä¿åµŒå¥—å­è¯„è®ºæ²¡æœ‰é¢å¤–ç¼©è¿› */
        }
        .comment-item .arrow {
            margin: 0 5px;
            color: #666;
        }
        .comment-item .userName + .arrow + .parentUserName {
            display: inline; /* ç¡®ä¿çˆ¶è¯„è®ºç”¨æˆ·åä¸ç®­å¤´åœ¨åŒä¸€è¡Œ */
        }
        /* ä¸ºåµŒå¥—è¯„è®ºé¡¹æ·»åŠ å®çº¿è¾¹æ¡† */
        .comment-children .comment-item,
        .comment-children-nested .comment-item {
            padding-left: 0; /* ç§»é™¤å†…è¾¹è· */
            margin-left: 0; /* ç§»é™¤å¤–è¾¹è· */
        }
        .reply-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            width: 300px; /* å›ºå®šå¯¹è¯æ¡†å®½åº¦ */
            box-sizing: border-box; /* ç¡®ä¿ padding ä¸ä¼šå¢åŠ å®½åº¦ */
        }

        .reply-dialog h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 18px;
            color: #333;
        }

        .reply-dialog input,
        .reply-dialog textarea {
            width: 100%; /* å®½åº¦å æ»¡çˆ¶å®¹å™¨ */
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; /* ç¡®ä¿ padding ä¸ä¼šå¢åŠ å®½åº¦ */
            font-family: Arial, sans-serif;
            font-size: 14px;
        }

        .reply-dialog textarea {
            height: 100px; /* è®¾ç½®æ–‡æœ¬åŒºåŸŸçš„é«˜åº¦ */
            resize: vertical; /* å…è®¸ç”¨æˆ·å‚ç›´è°ƒæ•´é«˜åº¦ */
        }

        .reply-dialog .dialog-buttons {
            display: flex;
            justify-content: flex-end; /* æŒ‰é’®å³å¯¹é½ */
            gap: 10px; /* æŒ‰é’®ä¹‹é—´çš„é—´è· */
        }

        .reply-dialog button {
            padding: 8px 16px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .reply-dialog button:hover {
            background-color: #0056b3;
        }

        .reply-dialog button#cancel-reply {
            background-color: #6c757d;
        }

        .reply-dialog button#cancel-reply:hover {
            background-color: #5a6268;
        }

    </style>
</head>
<body>
<h1>è¯„è®ºå±‚çº§æ¸²æŸ“ç¤ºä¾‹</h1>
<div id="comments-container"></div>

<!-- å›å¤å¯¹è¯æ¡† -->
<div class="overlay" id="overlay"></div>
<div class="reply-dialog" id="reply-dialog">
  <h3>å›å¤è¯„è®º</h3>
  <input type="text" id="reply-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
  <textarea id="reply-content" placeholder="è¯·è¾“å…¥å›å¤å†…å®¹"></textarea>
  <div class="dialog-buttons">
    <button id="submit-reply">æäº¤</button>
    <button id="cancel-reply">å–æ¶ˆ</button>
  </div>
</div>

<script>
        // æ¨¡æ‹Ÿè¯„è®ºæ•°æ®
        let comments = [
            { id: 1, parentId: 0, userName: "ç”¨æˆ·A", content: "è¿™æ˜¯æ ¹è¯„è®º1", creationDate: "2023-10-01" },
            { id: 2, parentId: 1, userName: "ç”¨æˆ·B", content: "è¿™æ˜¯å¯¹è¯„è®º1çš„å›å¤", creationDate: "2023-10-02" },
            { id: 3, parentId: 2, userName: "ç”¨æˆ·C", content: "è¿™æ˜¯å¯¹å›å¤çš„å›å¤", creationDate: "2023-10-03" },
            { id: 4, parentId: 0, userName: "ç”¨æˆ·D", content: "è¿™æ˜¯æ ¹è¯„è®º2", creationDate: "2023-10-04" },
            { id: 5, parentId: 4, userName: "ç”¨æˆ·E", content: "è¿™æ˜¯å¯¹è¯„è®º2çš„å›å¤", creationDate: "2023-10-05" },
            { id: 6, parentId: 3, userName: "ç”¨æˆ·F", content: "è¿™æ˜¯å¯¹è¯„è®º2çš„ç›´æ¥å­è¯„è®ºçš„å›å¤", creationDate: "2023-10-05" },
            { id: 7, parentId: 6, userName: "ç”¨æˆ·G", content: "è¿™æ˜¯å¯¹ç”¨æˆ·Fçš„å›å¤", creationDate: "2023-10-06" },
            { id: 8, parentId: 1, userName: "ç”¨æˆ·H", content: "è¿™æ˜¯å¯¹è¯„è®º1çš„å¦ä¸€ä¸ªå›å¤", creationDate: "2023-10-07" },
            { id: 9, parentId: 8, userName: "ç”¨æˆ·I", content: "è¿™æ˜¯å¯¹ç”¨æˆ·Hçš„å›å¤", creationDate: "2023-10-08" },
        ];

        // å½“å‰é€‰ä¸­çš„è¯„è®º ID
        let currentCommentId = null;

        /**
         * å°†æ‰å¹³çš„è¯„è®ºæ•°æ®æ„å»ºæˆæ ‘çŠ¶ç»“æ„
         * @param {Array} comments - è¯„è®ºæ•°ç»„
         * @returns {Array} æ ¹è¯„è®ºæ•°ç»„
         */
        function buildCommentTree(comments) {
            const map = {};
            const roots = [];

            // åˆ›å»ºè¯„è®ºå¯¹è±¡æ˜ å°„
            comments.forEach(comment => {
                map[comment.id] = { ...comment, children: [] };
            });

            // æ„å»ºæ ‘ç»“æ„
            comments.forEach(comment => {
                if (comment.parentId === 0) {
                    roots.push(map[comment.id]); // æ ¹è¯„è®º
                } else {
                    if (map[comment.parentId]) {
                        map[comment.parentId].children.push(map[comment.id]); // å­è¯„è®º
                        map[comment.id].parentUserName = map[comment.parentId].userName; // è®¾ç½®çˆ¶è¯„è®ºç”¨æˆ·å
                    }
                }
            });

            return roots;
        }

        /**
         * é€’å½’æ¸²æŸ“ä¸€æ¡è¯„è®ºåŠå…¶å­è¯„è®º
         * @param {Object} commentNode - è¯„è®ºèŠ‚ç‚¹
         * @param {number} depth - å½“å‰æ·±åº¦
         * @returns {HTMLElement} è¯„è®ºçš„ DOM å…ƒç´ 
         */
        function renderCommentNode(commentNode, depth = 0) {
            const commentItem = document.createElement("div");
            commentItem.className = "comment-item";

            // æ¸²æŸ“è¯„è®ºå†…å®¹
            if (depth === 0) {
                // æ ¹è¯„è®º
                commentItem.innerHTML = `
                    <p>
                        <img src="https://via.placeholder.com/30" alt="${commentNode.userName}çš„å¤´åƒ" class="comment-avatar">
                        <strong class="userName">${commentNode.userName}</strong>
                    </p>
                    <p class="comment-content">${commentNode.content}</p>
                    <p>
                        <span class="comment-date">${commentNode.creationDate}</span>
                        <span class="reply-button" data-comment-id="${commentNode.id}" title="å›å¤">ğŸ’¬ å›å¤</span>
                    </p>
                `;
            } else if (depth === 1) {
                // ç›´æ¥å­è¯„è®º
                commentItem.innerHTML = `
                    <p>
                        <img src="https://via.placeholder.com/30" alt="${commentNode.userName}çš„å¤´åƒ" class="comment-avatar">
                        <strong class="userName">${commentNode.userName}</strong>
                    </p>
                    <p class="comment-content">${commentNode.content}</p>
                    <p>
                        <span class="comment-date">${commentNode.creationDate}</span>
                        <span class="reply-button" data-comment-id="${commentNode.id}" title="å›å¤">ğŸ’¬ å›å¤</span>
                    </p>
                `;
            } else if (depth > 1) {
                // åµŒå¥—å­è¯„è®º
                commentItem.innerHTML = `
                    <p>
                        <img src="https://via.placeholder.com/30" alt="${commentNode.userName}çš„å¤´åƒ" class="comment-avatar">
                        <strong class="userName">${commentNode.userName}</strong>
                        <span class="arrow">â¤</span>
                        <strong class="parentUserName">${commentNode.parentUserName}</strong>
                    </p>
                    <p class="comment-content">${commentNode.content}</p>
                    <p>
                        <span class="comment-date">${commentNode.creationDate}</span>
                        <span class="reply-button" data-comment-id="${commentNode.id}" title="å›å¤">ğŸ’¬ å›å¤</span>
                    </p>
                `;
            }

            // æ¸²æŸ“å­è¯„è®º
            if (commentNode.children && commentNode.children.length > 0) {
                const childrenContainer = document.createElement("div");
                if (depth === 0) {
                    childrenContainer.className = "comment-children"; // ç›´æ¥å­è¯„è®ºç¼©è¿›
                } else if (depth >= 1) {
                    childrenContainer.className = "comment-children-nested"; // åµŒå¥—å­è¯„è®ºä¸ç¼©è¿›
                }

                commentNode.children.forEach(child => {
                    const childEl = renderCommentNode(child, depth + 1);
                    childrenContainer.appendChild(childEl);
                });

                commentItem.appendChild(childrenContainer);
            }

            return commentItem;
        }

        /**
         * æ¸²æŸ“è¯„è®ºå±‚çº§ç»“æ„
         * @param {Array} comments - è¯„è®ºæ•°ç»„
         * @param {HTMLElement} container - è¯„è®ºå®¹å™¨
         */
        function renderCommentsHierarchy(comments, container) {
            container.innerHTML = ""; // æ¸…ç©ºå®¹å™¨

            if (!comments || comments.length === 0) {
                container.innerHTML = "<p>æš‚æ— è¯„è®º</p>";
                return;
            }

            // æ„å»ºè¯„è®ºæ ‘å¹¶æ¸²æŸ“
            const roots = buildCommentTree(comments);
            roots.forEach(root => {
                const rootEl = renderCommentNode(root);
                container.appendChild(rootEl);
            });

            // ç»‘å®šå›å¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            const replyButtons = document.querySelectorAll(".reply-button");
            replyButtons.forEach(button => {
                button.addEventListener("click", () => {
                    currentCommentId = button.getAttribute("data-comment-id");
                    showReplyDialog();
                });
            });
        }

        /**
         * æ˜¾ç¤ºå›å¤å¯¹è¯æ¡†
         */
        function showReplyDialog() {
            const dialog = document.getElementById("reply-dialog");
            const overlay = document.getElementById("overlay");
            dialog.style.display = "block";
            overlay.style.display = "block";
        }

        /**
         * éšè—å›å¤å¯¹è¯æ¡†
         */
        function hideReplyDialog() {
            const dialog = document.getElementById("reply-dialog");
            const overlay = document.getElementById("overlay");
            dialog.style.display = "none";
            overlay.style.display = "none";
        }

        /**
         * æäº¤å›å¤
         */
        function submitReply() {
            const username = document.getElementById("reply-username").value.trim();
            const content = document.getElementById("reply-content").value.trim();

            if (!username || !content) {
                alert("ç”¨æˆ·åå’Œå›å¤å†…å®¹ä¸èƒ½ä¸ºç©ºï¼");
                return;
            }

            // ç”Ÿæˆæ–°çš„è¯„è®º
            const newComment = {
                id: comments.length + 1,
                parentId: parseInt(currentCommentId),
                userName: username,
                content: content,
                creationDate: new Date().toLocaleDateString(),
            };

            // æ’å…¥åˆ°commentsæ•°ç»„çš„ç›¸åº”ä½ç½®
            if (newComment.parentId === 0) {
                // æ–°çš„æ ¹è¯„è®ºï¼Œæ’å…¥åˆ°æœ€å‰é¢
                comments.unshift(newComment);
            } else {
                // æ‰¾åˆ°çˆ¶è¯„è®ºï¼Œå¹¶å°†å…¶æ’å…¥åˆ°çˆ¶è¯„è®ºçš„å­è¯„è®ºåˆ—è¡¨çš„æœ€å‰é¢
                const parentComment = comments.find(c => c.id === newComment.parentId);
                if (parentComment) {
                    // é‡æ–°æ’åˆ—çˆ¶è¯„è®ºçš„å­è¯„è®ºï¼Œå°†æ–°è¯„è®ºæ”¾åœ¨æœ€å‰é¢
                    comments = comments.filter(c => c.id !== newComment.id);
                    comments.splice(comments.indexOf(parentComment) + 1, 0, newComment);
                } else {
                    // å¦‚æœçˆ¶è¯„è®ºä¸å­˜åœ¨ï¼Œå°†å…¶ä½œä¸ºæ ¹è¯„è®ºæ’å…¥
                    comments.unshift(newComment);
                }
            }

            // é‡æ–°æ¸²æŸ“è¯„è®º
            const commentsContainer = document.getElementById("comments-container");
            renderCommentsHierarchy(comments, commentsContainer);

            // éšè—å¯¹è¯æ¡†
            hideReplyDialog();

            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById("reply-username").value = "";
            document.getElementById("reply-content").value = "";
        }

        // åˆå§‹åŒ–æ¸²æŸ“
        const commentsContainer = document.getElementById("comments-container");
        renderCommentsHierarchy(comments, commentsContainer);

        // ç»‘å®šæäº¤å’Œå–æ¶ˆæŒ‰é’®äº‹ä»¶
        document.getElementById("submit-reply").addEventListener("click", submitReply);
        document.getElementById("cancel-reply").addEventListener("click", hideReplyDialog);
    </script>
</body>
</html>